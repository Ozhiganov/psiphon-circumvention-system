#!/bin/bash

# NOTE: You need to have arm-none-linux-gnueabi-gcc in your path.

export HOST=arm-none-linux-gnueabi
export CC=$HOST-gcc
export STRIP=$HOST-strip
export PREFIX=$PWD/$HOST

export ZLIB_DIR=zlib-1.2.6
export OPENSSL_DIR=openssl-1.0.1
export OPENSSH_DIR=openssh-5.9p1

# zlib
pushd $ZLIB_DIR
./configure --prefix=$PREFIX
make clean && make && make install
popd

# openssl
pushd $OPENSSL_DIR
./Configure android-armv7 --prefix=$PREFIX
make clean && make build_libs && make install_sw
popd

# openssh
export LDFLAGS=-L$PWD/$OPENSSL_DIR
pushd $OPENSSH_DIR
./configure --with-ldflags=-static --host=$HOST --with-zlib=$PREFIX
make clean && make
popd

cp $OPENSSH_DIR/ssh .
$STRIP ssh

