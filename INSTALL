--------------------------------------------------------------------------------
Psiphon 3 Circumvention System INSTALL
--------------------------------------------------------------------------------


Contents
--------------------------------------------------------------------------------

Overview
Build/Deploy Host Installation
Debian Server Host Installation
Network Database Configuration


Overview
--------------------------------------------------------------------------------

A Psiphon 3 system consists of:

- A database of network assets. Currently, this is stored in spreadsheet form
in Data/psi_db.xls.

- A number of server hosts. A host consists of one or more servers. In our
terminology, a server is a single instance of the server software behind a
single IP address.

- A set of client builds.

- A build/deploy host.

The build/deploy host is set up manually. Part of each server host setup is also
performed manually. The build script is used to create client executables on
the build/deploy host and from the same host a deploy script completes the
server hosts installs or updates server hosts with new information.


Build/Deploy Host Installation
--------------------------------------------------------------------------------

Dependencies
------------

- Windows XP/Vista/7
- Microsoft Visual Studio Express 10
- Microsoft Platform SDK
- Python 2.6+ and modules


1. Python setup
---------------

- Download and install Python 2.6+:

  http://www.python.org/download/releases/2.6/

- Download and install the corresponding version of setup tools:

  http://pypi.python.org/pypi/setuptools#downloads

- Install additional modules:

  easy_install paramiko pyOpenSSL pywin32 jsonpickle PyYAML qrcode PIL requests

[NOTE: you may require Visual C++ 2008, NOT 2010, to build Python modules
 (http://mail.python.org/pipermail/python-list/2010-April/1242706.html).
 Alternatively, you may use MinGW.]

- On Windows, install PycURL from here:

  http://www.lfd.uci.edu/~gohlke/pythonlibs/


2. Windows Client Build Setup
-----------------------------

- Install Microsoft Visual Studio 10

- Install Windows Platform SDK

  http://msdn.microsoft.com/en-us/windows/bb980924

- Authenticode code signing setup

Psiphon includes support for authenticode signing of the client builds. Code
signing is performed by the automated build script using keys found in the
Data/CodeSigning subdirectory of the source tree. The included keys are for
test purposes only. For production use, obtain a code signing certificate from
a commercial CA.

To manually test the individual code signing commands:

- Create a new test signing key:
"<Path to SDK>\Bin\makecert.exe" -r -sv key.pvk -n "CN=MyCN" cert.spc
"<Path to SDK>\Bin\pvk2pfx.exe" -pvk key.pvk -spc cert.spc -pfx MyPFX.pfx

- Sign an executable:
"<Path to SDK>\Bin\signtool.exe" sign /f MyPFX.pfx psiphon.exe

- Review tool paths in Automation/psi_build.py and adjust if required.


3. Android Client Build Setup
-----------------------------

[TODO]


4. Server Install
-----------------

See the section below on Debian Server Host Installation.


5. Client Build
---------------

- Invoke the build script

  cd Automation
  python psi_build.py

Outputs are in Automation/Builds. There is one client per Sponsor ID and
Client ID. For more information on these values, see the design paper and see
the section below on configuring the network database.

If building new clients, invoke the deploy script to upload the builds to the
hosts in your network database for automatic client upgrade.

- Invoke the deploy script

  cd Automation
  python psi_deploy.py


TODO: document full automation
- NOTE: the Linode automation script requires an Administrator shell


Debian/Ubuntu Host Installation
-------------------------------

**SEE INSTALL_host.md**

Debian/Ubuntu Server Installation
---------------------------------

**SEE INSTALL_server.md**

